<form>
  <label>RBA Correlation Audit</label>
  <fieldset submitButton="true" autoRun="true">
    <input type="time" token="field1">
      <label></label>
      <default>
        <earliest>0</earliest>
        <latest></latest>
      </default>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>RBA Correlation Execution</title>
      <table>
        <title>Click to see recent notable or risk events</title>
        <search>
          <query>index=_internal sourcetype=scheduler result_count savedsearch_name="* - RIR - *" OR savedsearch_name="* - RR - *" 
| extract pairdelim=",", kvdelim="=", auto=f 
| stats avg(result_count) as avg_results max(result_count) as max_results sparkline avg(run_time) as avg_runtime max(run_time) as max_runtime count AS execution_count by savedsearch_name, app 
| join savedsearch_name type=outer 
    [| rest splunk_server=local /servicesNS/-/-/saved/searches 
    | fields title description eai:acl.app eai:acl.sharing eai:acl.owner cron_schedule dispatch.earliest_time dispatch.latest_time, disabled actions 
    | rename title AS savedsearch_name eai:acl.app AS App eai:acl.owner AS Owner cron_schedule AS "Cron Schedule" dispatch.earliest_time AS "Dispatch Earliest Time" dispatch.latest_time AS "Dispatch Latest Time" actions AS "Adaptive Response Actions", eai:acl.sharing AS Sharing] 
    
`comment("This is just to make the demo work below since we do not have execution results in _internal")` 
| append 
    [| rest splunk_server=local /servicesNS/-/-/saved/searches 
    | search title="* - RIR - *" OR title="* - RR - *" 
    | fields title description eai:acl.app eai:acl.sharing eai:acl.owner cron_schedule dispatch.earliest_time dispatch.latest_time, disabled actions 
    | rename title AS savedsearch_name eai:acl.app AS App eai:acl.owner AS Owner cron_schedule AS "Cron Schedule" dispatch.earliest_time AS "Dispatch Earliest Time" dispatch.latest_time AS "Dispatch Latest Time" actions AS "Adaptive Response Actions", eai:acl.sharing AS Sharing] 

| join savedsearch_name type=outer
 [ | search index=risk | stats sum(risk_score) AS "total_risk" by source | rename source as savedsearch_name]

| rename savedsearch_name AS "Saved Search Name" description AS Description 
| eval Enabled = if(disabled=1, "False", "True")
| sort - avg(run_time) 
| makemv delim="," "Adaptive Response Actions" 
| eval avg_runtime = round(avg_runtime, 1) 
| eval avg_results = round(avg_results, 0) 
| table "Saved Search Name", Description, App, Enabled, total_risk, "Adaptive Response Actions", "Cron Schedule", "Dispatch Earliest Time", "Dispatch Latest Time", execution_count, sparkline, avg_results, max_results, avg_runtime, max_runtime</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <drilldown>
          <set token="tok_savedsearchname">$row.Saved Search Name$</set>
        </drilldown>
      </table>
    </panel>
    <panel depends="$tok_savedsearchname$">
      <event>
        <search>
          <query>index=notable OR index=risk source="$tok_savedsearchname$" | fields * | head 20</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="list.drilldown">full</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <unset token="tok_sourcetype"></unset>
        </drilldown>
      </event>
    </panel>
  </row>
  <row>
    <panel>
      <title>Risk Rule Components Audit - Only inconsistant rules displayed</title>
      <table>
        <search>
          <query>| rest splunk_server=local /servicesNS/-/-/saved/searches 
| search title="* - RR - *" 
| fields title description eai:acl.app eai:acl.sharing eai:acl.owner search
| eval rule_attack_tactic_technique_missing = if(like(search, "%rule_attack_tactic_technique%"), "false", "true")
| eval risk_message_missing = if(like(search, "%risk_message%"), "false", "true")
| eval impact_missing = if(like(search, "%impact%"), "false", "true")
| eval confidence_missing = if(like(search, "%confidence%"), "false", "true")
| eval TESTMODE_missing = if(like(search, "%TESTMODE%"), "false", "true")
| rex field=search "rule_attack_tactic_technique\s*=\s*\"(?P&lt;rule_attack_tactic_technique&gt;[^\"]*)"
| makemv delim="|" rule_attack_tactic_technique
| mvexpand rule_attack_tactic_technique
| eval rule_attack_tactic_technique_format_issue = if(match(rule_attack_tactic_technique, "[^-]*\s-\sT\d{4}\s-\s[^-]*\s-\shttp[^-]*"), "false", "true")
| search rule_attack_tactic_technique_missing = "true" OR risk_message_missing = "true" OR impact_missing = "true" OR confidence_missing = "true" OR TESTMODE_missing = "true" OR rule_attack_tactic_technique_format_issue = "true"
| table title, rule_attack_tactic_technique_missing, risk_message_missing, impact_missing, confidence_missing, TESTMODE_missing, rule_attack_tactic_technique_format_issue</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="risk_message_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="risk_message_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="risk_message_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="risk_message_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="impact_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="risk_message_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="risk_message_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="risk_message_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="risk_message_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="impact_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="confidence_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="risk_message_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="risk_message_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="risk_message_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="risk_message_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="impact_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="risk_message_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="risk_message_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="risk_message_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="TESTMODE_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="risk_message_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="impact_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="confidence_missing">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="rule_attack_tactic_technique_format_issue">
          <colorPalette type="map">{"true":#DC4E41}</colorPalette>
        </format>
        <drilldown>
          <link target="_blank">search?q=%7C%20rest%20splunk_server=local%20/servicesNS/-/-/saved/searches%20%0A%7C%20search%20title=%22$row.title$%22%20%0A%7C%20fields%20title%20search&amp;earliest=$field1.earliest$&amp;latest=$field1.latest$</link>
        </drilldown>
      </table>
    </panel>
  </row>
</form>
